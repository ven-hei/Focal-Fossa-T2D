{% extends "base.html" %}

{% block title %}Summary Statistics{% endblock %}

{% block content %}
<div class="content container mt-5 p-4 bg-light shadow rounded">
    <h1 class="text-center text-primary">Summary Statistics</h1>
    
    <form action="{{ url_for('summary_stats_result') }}" method="GET" class="mt-4">
        <!-- Population selection -->
        <div class="mb-3">
            <h3 class="text-secondary">Choose Population(s):</h3>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="population" value="BEB" id="beb">
                <label class="form-check-label" for="beb">Bengali (BEB)</label><br>
                <input class="form-check-input" type="checkbox" name="population" value="ITU" id="itu">
                <label class="form-check-label" for="itu">Indian (ITU)</label><br>
                <input class="form-check-input" type="checkbox" name="population" value="PJL" id="pjl">
                <label class="form-check-label" for="pjl">Punjabi (PJL)</label><br>
                <input class="form-check-input" type="checkbox" name="population" value="GIH" id="gih">
                <label class="form-check-label" for="gih">Gujarati (GIH)</label><br>
            </div>
        </div>

        <!-- Filter type selection -->
        <div class="mb-3">
            <h3 class="text-secondary">Select Filter Type:</h3>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="filter_type" value="rs" id="rs_filter" checked>
                <label class="form-check-label" for="rs_filter">Filter by rs Numbers</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="filter_type" value="region" id="region_filter">
                <label class="form-check-label" for="region_filter">Filter by Genomic Region</label>
            </div>
        </div>

        <!-- Chromosome selection -->
        <div class="mb-3">
            <h3 class="text-secondary">Select Chromosome:</h3>
            <select name="chromosome" class="form-select">
                <option value="all">All Chromosomes (1-22)</option>
                {% for i in range(1, 23) %}
                    <option value="chr{{ i }}">Chromosome {{ i }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Input group for genomic region -->
        <div class="mb-3" id="region-input-group">
            <h3 class="text-secondary">Enter Position Range (Optional):</h3>
            <div class="input-group">
                <input type="text" name="position_start" class="form-control" placeholder="Start Position">
                <span class="input-group-text">to</span>
                <input type="text" name="position_end" class="form-control" placeholder="End Position">
            </div>
        </div>

        <!-- Input group for rs numbers -->
        <div class="mb-3" id="rs-input-group">
            <h3 class="text-secondary">Enter rs Number(s) (Optional):</h3>
            <input type="text" name="rs_numbers" class="form-control" placeholder="e.g., rs123, rs456">
        </div>
        
        <!-- Summary statistics parameters -->
        <div class="mb-3">
            <h3 class="text-secondary">Choose Summary Statistics:</h3>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="parameter" value="Tajima D" id="tajima">
                <label class="form-check-label" for="tajima">Tajima D</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="parameter" value="Fst" id="fst">
                <label class="form-check-label" for="fst">Fst</label>
            </div>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg">Analyse</button>
        </div>
    </form>
</div>

<!-- JavaScript to conditionally display input groups -->
<script>
document.addEventListener("DOMContentLoaded", function(){
    var rsInputGroup = document.getElementById("rs-input-group");
    var regionInputGroup = document.getElementById("region-input-group");

    function toggleInputDisplay() {
        var filterType = document.querySelector('input[name="filter_type"]:checked').value;
        if(filterType === "rs") {
            rsInputGroup.style.display = "block";
            regionInputGroup.style.display = "none";
        } else if(filterType === "region") {
            rsInputGroup.style.display = "none";
            regionInputGroup.style.display = "block";
        }
    }

    // Attach change event listeners to the radio buttons
    var filterRadios = document.querySelectorAll('input[name="filter_type"]');
    filterRadios.forEach(function(radio){
        radio.addEventListener("change", toggleInputDisplay);
    });

    // Initialize display based on the default selection
    toggleInputDisplay();
});
</script>
{% endblock %}
